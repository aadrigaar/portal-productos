<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Productos</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <style>
        /* =========================================================
           ESTILOS GENERALES (Tu dise√±o favorito)
           ========================================================= */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; line-height: 1.6; height: 100vh; overflow-x: hidden; }
        .hidden { display: none !important; }

        /* Header Gradient */
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .header h1 { margin-bottom: 1rem; font-size: 2rem; }
        .nav { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        
        .nav-btn, .auth-btn {
            background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem;
            border-radius: 20px; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem;
            display: inline-flex; align-items: center; gap: 5px;
        }
        .nav-btn:hover, .auth-btn:hover { background: rgba(255,255,255,0.3); transform: translateY(-2px); }
        .nav-btn.active { background: rgba(255,255,255,0.4); font-weight: bold; }

        /* Main */
        .main-content { padding: 2rem; max-width: 1200px; margin: 0 auto; min-height: calc(100vh - 120px); }
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Hero */
        .hero { text-align: center; padding: 3rem 2rem; background: white; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .hero h2 { color: #667eea; margin-bottom: 1rem; font-size: 2.5rem; }
        .features { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-top: 2rem; }
        .feature-card { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 2rem; border-radius: 10px; text-align: center; transition: transform 0.3s ease; }
        .feature-card:hover { transform: translateY(-5px); }

        /* FILTROS (Estilo adaptado al dise√±o morado) */
        .filters-panel { background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem; border: 1px solid #eee; }
        .search-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .search-box { flex: 1; position: relative; }
        .search-box input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
        .filters-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; border-top: 1px solid #eee; padding-top: 15px; }
        .filter-group label { display: block; font-size: 0.85rem; font-weight: bold; color: #555; margin-bottom: 5px; }
        select, input[type="number"] { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; }

        /* Productos */
        .products-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; }
        .product-card { background: white; border-radius: 12px; padding: 1.5rem; border: 1px solid #eee; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s ease; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0,0,0,0.2); }
        .product-card img { width: 100%; height: 200px; object-fit: contain; border-radius: 8px; margin-bottom: 1rem; }
        .product-card h3 { color: #333; margin-bottom: 0.5rem; font-size: 1.3rem; }
        .product-card .price { font-size: 1.5rem; font-weight: bold; color: #667eea; margin: 0.5rem 0; }
        .category { display: inline-block; padding: 2px 8px; background: #eee; border-radius: 10px; font-size: 0.8rem; color: #666; }

        /* Botones */
        .btn-primary { background: #667eea; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 10px; }
        .btn-primary:hover { background: #5a6fd8; }
        .btn-secondary { background: #718096; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        .btn-danger { background: #fc8181; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }

        /* Auth Forms */
        .auth-form { max-width: 400px; margin: 2rem auto; padding: 2rem; background: white; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .auth-form h2 { text-align: center; color: #667eea; margin-bottom: 1.5rem; }
        .auth-form input { width: 100%; padding: 0.75rem; margin-bottom: 1rem; border: 1px solid #ddd; border-radius: 8px; }
        .auth-form button { width: 100%; padding: 0.75rem; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; }

        /* =========================================================
           CHAT ARREGLADO (SOLUCI√ìN FLEXBOX DEFINITIVA)
           ========================================================= */
        .chat-container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 15px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            overflow: hidden; 
            
            /* ESTO ES LA CLAVE PARA QUE NO SE ROMPA */
            display: flex;
            flex-direction: column;
            height: 600px; /* Altura fija obligatoria */
        }

        .chat-header { 
            background: #667eea; 
            color: white; 
            padding: 1rem; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            flex-shrink: 0; /* No encoger header */
        }

        .chat-body-layout {
            display: flex;
            flex: 1; /* Ocupa el resto del espacio */
            overflow: hidden; /* Cortar lo que sobre */
        }

        /* Lista de usuarios a la izquierda */
        .chat-sidebar {
            width: 200px;
            background: #f8f9fa;
            border-right: 1px solid #eee;
            padding: 10px;
            overflow-y: auto;
            flex-shrink: 0;
        }
        
        .chat-main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .chat-messages { 
            flex: 1; /* Crece para ocupar espacio */
            overflow-y: auto; /* Scroll aqu√≠ */
            padding: 1rem; 
            background: #fafafa;
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 0; /* Truco Flexbox para scroll */
        }

        .chat-message { padding: 0.75rem 1rem; border-radius: 12px; max-width: 75%; position: relative; font-size: 0.95rem; }
        .chat-message.own { margin-left: auto; background: #667eea; color: white; border-bottom-right-radius: 2px; }
        .chat-message.other { margin-right: auto; background: white; border: 1px solid #e2e8f0; border-bottom-left-radius: 2px; }
        .chat-message.system { margin: 10px auto; background: #edf2f7; color: #718096; text-align: center; font-style: italic; max-width: 90%; }
        .chat-message .username { font-size: 0.75rem; font-weight: bold; margin-bottom: 2px; }

        /* INPUT AREA FIJA */
        .chat-input-container { 
            padding: 1rem; 
            background: white; 
            display: flex; 
            gap: 10px; 
            border-top: 1px solid #eee;
            flex-shrink: 0; /* IMPIDE QUE DESAPAREZCA */
        }
        
        .chat-input-container input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ddd; outline: none; }
        .chat-input-container button { width: auto; padding: 0 20px; border-radius: 20px; margin-top: 0; }

        .online-user { padding: 5px; border-bottom: 1px solid #eee; font-size: 0.9rem; display: flex; align-items: center; gap: 5px; }
        .online-dot { width: 8px; height: 8px; background: #48bb78; border-radius: 50%; }

        /* Modal */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 999; }
        .modal-content { background: white; padding: 2rem; border-radius: 12px; width: 90%; max-width: 500px; }
        .modal input, .modal textarea { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 10px; }
    </style>
</head>
<body>
    <div id="app">
        <header class="header">
            <h1>üõçÔ∏è Portal de Productos</h1>
            <nav class="nav">
                <div class="nav-group">
                    <button onclick="app.showSection('homeSection')" class="nav-btn active" id="homeBtn"><i class="ri-home-line"></i> Inicio</button>
                    <button onclick="app.showSection('productsSection')" class="nav-btn hidden" id="productsBtn"><i class="ri-store-line"></i> Productos</button>
                    <button onclick="app.showSection('cartSection')" class="nav-btn hidden" id="navCartBtn"><i class="ri-shopping-cart-line"></i> Carrito (<span id="cartCount">0</span>)</button>
                    <button onclick="app.showSection('chatSection')" class="nav-btn hidden" id="chatBtn"><i class="ri-chat-3-line"></i> Chat</button>
                </div>
                
                <div class="nav-group">
                    <button onclick="app.showSection('adminOrdersSection')" class="nav-btn hidden admin-only" id="navAdminOrders">Pedidos</button>
                    <button onclick="app.showSection('adminUsersSection')" class="nav-btn hidden admin-only" id="navAdminUsers">Usuarios</button>
                </div>

                <div id="authSection" class="nav-group">
                    <button onclick="app.showSection('loginSection')" class="auth-btn" id="loginBtn">Entrar</button>
                    <button onclick="app.showSection('registerSection')" class="auth-btn" id="registerBtn">Registro</button>
                    <button onclick="app.logout()" class="auth-btn hidden" id="logoutBtn">Salir</button>
                    <span id="userInfo" class="hidden" style="color:white; font-weight:bold; margin-left:10px"></span>
                </div>
            </nav>
        </header>

        <main class="main-content">
            
            <section id="homeSection" class="section active">
                <div class="hero">
                    <h2>Bienvenido al Portal de Productos</h2>
                    <p>Pr√°ctica 2: E-commerce, GraphQL y Chat en Tiempo Real</p>
                    <div class="features">
                        <div class="feature-card"><h3>üöÄ GraphQL</h3><p>API Moderna</p></div>
                        <div class="feature-card"><h3>üõí Carrito</h3><p>Gesti√≥n de Pedidos</p></div>
                        <div class="feature-card"><h3>üí¨ Chat</h3><p>Sockets Web</p></div>
                    </div>
                </div>
            </section>

            <section id="loginSection" class="section hidden">
                <div class="auth-form">
                    <h2>Iniciar Sesi√≥n</h2>
                    <form onsubmit="app.handleLogin(event)" id="loginForm">
                        <input type="email" id="loginEmail" placeholder="Email" required>
                        <input type="password" id="loginPassword" placeholder="Contrase√±a" required>
                        <button type="submit">Ingresar</button>
                    </form>
                </div>
            </section>

            <section id="registerSection" class="section hidden">
                <div class="auth-form">
                    <h2>Crear Cuenta</h2>
                    <form onsubmit="app.handleRegister(event)" id="registerForm">
                        <input type="text" id="registerUsername" placeholder="Usuario" required>
                        <input type="email" id="registerEmail" placeholder="Email" required>
                        <input type="password" id="registerPassword" placeholder="Contrase√±a" required>
                        <button type="submit">Registrarse</button>
                    </form>
                </div>
            </section>

            <section id="productsSection" class="section hidden">
                <div class="products-header">
                    <h2>Cat√°logo</h2>
                    <button onclick="app.showProductModal()" class="btn-primary hidden" id="addProductBtn" style="width:auto">+ Nuevo Producto</button>
                </div>
                
                <div class="filters-panel">
                    <div class="search-row">
                        <div class="search-box">
                            <input type="text" id="searchInput" placeholder="üîç Buscar productos..." onkeyup="app.filterProductsLocal()">
                        </div>
                        <button class="btn-secondary" onclick="app.toggleFilters()">Filtros</button>
                    </div>
                    <div class="filters-grid hidden" id="filtersGrid">
                        <div class="filter-group">
                            <label>Categor√≠a</label>
                            <select id="filterCategory" onchange="app.filterProductsLocal()">
                                <option value="all">Todas</option>
                                <option value="Electr√≥nicos">Electr√≥nicos</option>
                                <option value="Hogar">Hogar</option>
                                <option value="Inform√°tica">Inform√°tica</option>
                            </select>
                        </div>
                        <div class="filter-group"><label>M√≠nimo</label><input type="number" id="filterMinPrice" placeholder="0" onkeyup="app.filterProductsLocal()"></div>
                        <div class="filter-group"><label>M√°ximo</label><input type="number" id="filterMaxPrice" placeholder="9999" onkeyup="app.filterProductsLocal()"></div>
                        <div class="filter-group">
                            <label>Orden</label>
                            <select id="filterSort" onchange="app.filterProductsLocal()">
                                <option value="nameAsc">A-Z</option>
                                <option value="priceAsc">Precio Bajo</option>
                            </select>
                        </div>
                    </div>
                    <div id="resultsCount" style="text-align:center; color:#888; font-size:0.8rem; margin-top:10px"></div>
                </div>

                <div id="productsList" class="products-grid"></div>
            </section>

            <section id="cartSection" class="section hidden">
                <div class="chat-container">
                    <div class="chat-header"><div style="font-weight:bold; font-size:1.2rem;">üõí Tu Carrito</div></div>
                    <div style="padding:20px;">
                        <div id="cartItemsContainer"></div>
                        <div style="text-align:right; margin-top:20px; border-top:1px solid #eee; padding-top:10px;">
                            <h3>Total: $<span id="cartTotal">0.00</span></h3>
                            <button onclick="app.checkout()" class="btn-primary" style="width:200px;">Realizar Pedido</button>
                        </div>
                    </div>
                </div>
                <div class="chat-container" style="margin-top:20px; height:auto">
                    <div class="chat-header" style="background:#4a5568"><div style="font-weight:bold; font-size:1.2rem;">üì¶ Mis Pedidos Anteriores</div></div>
                    <div id="myOrdersList" style="padding:20px;"></div>
                </div>
            </section>

            <section id="adminOrdersSection" class="section hidden">
                <div class="chat-container">
                    <div class="chat-header" style="display:flex; justify-content:space-between">
                        <div style="font-weight:bold; font-size:1.2rem;">üìã Gesti√≥n de Pedidos</div>
                        <select onchange="app.filterAdminOrders(this.value)" style="color:black; width:auto">
                            <option value="all">Todos</option>
                            <option value="pending">Pendientes</option>
                            <option value="completed">Completados</option>
                        </select>
                    </div>
                    <div id="adminOrdersList" style="padding:20px;"></div>
                </div>
            </section>

            <section id="adminUsersSection" class="section hidden">
                <div class="chat-container">
                    <div class="chat-header"><div style="font-weight:bold; font-size:1.2rem;">üë• Gesti√≥n de Usuarios</div></div>
                    <div id="usersList" style="padding:20px;"></div>
                </div>
            </section>

            <section id="chatSection" class="section hidden">
                <div class="chat-container">
                    <div class="chat-header">
                        <div>üí¨ Chat Global</div>
                        <div style="font-size:0.9rem">Online: <span id="onlineCount">0</span></div>
                    </div>
                    
                    <div class="chat-body-layout">
                        <div class="chat-sidebar">
                            <div style="font-size:0.8rem; font-weight:bold; color:#888; margin-bottom:10px">USUARIOS</div>
                            <ul id="usersOnlineList" style="list-style:none"></ul>
                        </div>

                        <div class="chat-main-area">
                            <div id="chatMessages" class="chat-messages">
                                <div class="chat-message system">Conectando...</div>
                            </div>
                            <div id="typingIndicator" class="hidden" style="position:absolute; bottom:5px; left:10px; font-size:0.8rem; color:#888"></div>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <input type="text" id="chatInput" placeholder="Escribe un mensaje..." disabled>
                        <button id="sendMessageBtn" onclick="app.sendMessage()" disabled>Enviar</button>
                    </div>
                </div>
            </section>

        </main>

        <div id="productModal" class="modal hidden">
            <div class="modal-content">
                <h3>Gesti√≥n de Producto</h3>
                <form onsubmit="app.handleProductSubmit(event)" id="productForm">
                    <input type="text" id="productName" placeholder="Nombre" required>
                    <textarea id="productDescription" placeholder="Descripci√≥n"></textarea>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px">
                        <input type="number" id="productPrice" placeholder="Precio" step="0.01" required>
                        <input type="number" id="productStock" placeholder="Stock" required>
                    </div>
                    <input type="text" id="productCategory" placeholder="Categor√≠a" required>
                    <input type="text" id="productImage" placeholder="URL Imagen">
                    <div class="modal-actions">
                        <button type="submit" class="btn-primary" style="width:auto">Guardar</button>
                        <button type="button" onclick="app.hideProductModal()" class="btn-secondary">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="client.js"></script>
</body>
</html>